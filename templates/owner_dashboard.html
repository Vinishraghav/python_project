{% extends 'base.html' %}

{% block title %}Van Owner Dashboard{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="row mb-4">
    <div class="col-md-8">
      <h1 class="display-5 fw-bold">
        <i class="fas fa-tachometer-alt me-2 text-primary"></i>Van Owner Dashboard
      </h1>
      <p class="lead text-muted">Manage your vans and bookings in one place</p>
    </div>
    <div class="col-md-4 text-md-end d-flex align-items-center justify-content-md-end">
      <a href="{{ url_for('home') }}" class="btn btn-outline-primary me-2">
        <i class="fas fa-home me-1"></i>Home
      </a>
      <a href="{{ url_for('logout') }}" class="btn btn-outline-danger">
        <i class="fas fa-sign-out-alt me-1"></i>Logout
      </a>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="row mb-4">
    <div class="col-md-3 mb-3">
      <div class="card h-100 border-0 shadow-sm">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="rounded-circle bg-primary bg-opacity-10 p-3 me-3">
              <i class="fas fa-calendar-check text-primary fa-2x"></i>
            </div>
            <div>
              <h6 class="text-muted mb-1">Total Bookings</h6>
              <h3 class="mb-0">{{ stats.total_bookings }}</h3>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="card h-100 border-0 shadow-sm">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="rounded-circle bg-success bg-opacity-10 p-3 me-3">
              <i class="fas fa-clock text-success fa-2x"></i>
            </div>
            <div>
              <h6 class="text-muted mb-1">Upcoming</h6>
              <h3 class="mb-0">{{ stats.upcoming_bookings }}</h3>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="card h-100 border-0 shadow-sm">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="rounded-circle bg-info bg-opacity-10 p-3 me-3">
              <i class="fas fa-route text-info fa-2x"></i>
            </div>
            <div>
              <h6 class="text-muted mb-1">Active Trips</h6>
              <h3 class="mb-0">{{ stats.active_bookings }}</h3>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="card h-100 border-0 shadow-sm">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="rounded-circle bg-warning bg-opacity-10 p-3 me-3">
              <i class="fas fa-dollar-sign text-warning fa-2x"></i>
            </div>
            <div>
              <h6 class="text-muted mb-1">Revenue</h6>
              <h3 class="mb-0">${{ stats.total_revenue }}</h3>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Your Vans Section -->
  <div class="card border-0 shadow-sm mb-4">
    <div class="card-header bg-white py-3">
      <div class="d-flex justify-content-between align-items-center">
        <h5 class="mb-0">
          <i class="fas fa-shuttle-van text-primary me-2"></i>Your Vans
        </h5>
        <a href="{{ url_for('add_van') }}" class="btn btn-sm btn-primary">
          <i class="fas fa-plus me-1"></i>Add New Van
        </a>
      </div>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>ID</th>
              <th>Van Name</th>
              <th>Price/Day</th>
              <th>Seats</th>
              <th>Location</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for van in vans %}
            <tr>
              <td>{{ van.id }}</td>
              <td>{{ van.name }}</td>
              <td>${{ van.price }}</td>
              <td>{{ van.seats }}</td>
              <td>
                <span class="location-badge">
                  <i class="fas fa-map-marker-alt me-1"></i>{{ van.location }}
                </span>
                <div class="small text-muted">Updated: {{ van.last_updated }}</div>
              </td>
              <td>
                <span class="badge bg-success">Available</span>
              </td>
              <td>
                <div class="btn-group">
                  <a href="{{ url_for('owner_calendar', van_id=van.id) }}" class="btn btn-sm btn-outline-primary">
                    <i class="fas fa-calendar-alt me-1"></i>Calendar
                  </a>
                  <a href="{{ url_for('edit_van', van_id=van.id) }}" class="btn btn-sm btn-outline-secondary">
                    <i class="fas fa-edit me-1"></i>Edit
                  </a>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Recent Bookings Section -->
  <div class="card border-0 shadow-sm">
    <div class="card-header bg-white py-3">
      <h5 class="mb-0">
        <i class="fas fa-calendar-check text-primary me-2"></i>Recent Bookings
      </h5>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>ID</th>
              <th>Van</th>
              <th>Customer</th>
              <th>Dates</th>
              <th>Passengers</th>
              <th>Total</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            {% for booking in bookings %}
            <tr>
              <td>{{ booking.id }}</td>
              <td>{{ vans|selectattr('id', 'eq', booking.van_id)|map(attribute='name')|first }}</td>
              <td>{{ booking.user }}</td>
              <td>
                <div>{{ booking.start_date.strftime('%b %d, %Y') }}</div>
                <div class="text-muted">to</div>
                <div>{{ booking.end_date.strftime('%b %d, %Y') }}</div>
              </td>
              <td>{{ booking.passengers }}</td>
              <td>${{ booking.total_price }}</td>
              <td>
                <span class="badge bg-success">{{ booking.status }}</span>
              </td>
            </tr>
            {% endfor %}
            {% if not bookings %}
            <tr>
              <td colspan="7" class="text-center py-4">
                <div class="text-muted">No bookings yet</div>
              </td>
            </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<style>
  /* Location Badge */
  .location-badge {
    display: inline-flex;
    align-items: center;
    background-color: #f0f8ff;
    color: #4A6DA7;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.9rem;
  }
</style>
{% endblock %}
